pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
function _init()
  -- player
  p = {}
  p.x = 64
  p.y = 80
  p.sp = 1
  p.spd = 1.2
  p.r = 30           -- the player's detection range
  p.lookx = 0
  p.looky = -1
  p.target = nil
  
  -- attack timers
  p.atk_timer = 0
  p.atk_cooldown = 0

  -- enemy list
  enemies = {}
  add(enemies, {x=40, y=50, sp=2})
  add(enemies, {x=80, y=50, sp=2})
end
-->8
function _update()
  -- 1. movement
  local dx, dy = 0, 0
  if (btn(0)) dx -= 1
  if (btn(1)) dx += 1
  if (btn(2)) dy -= 1
  if (btn(3)) dy += 1
  p.x += dx * p.spd
  p.y += dy * p.spd

  -- 2. attack logic
  if p.atk_timer > 0 then p.atk_timer -= 1 end
  if p.atk_cooldown > 0 then p.atk_cooldown -= 1 end

  if btn(5) then
    -- if no target, find the closest one inside player's circle
    if p.target == nil then
      p.target = find_closest_in_range()
    else
      -- already have a target, check if they are still in player's circle
      local dist = distance_to(p.target)
      if dist > p.r then
        p.target = nil -- target escaped the player's circle
      end
    end

    -- look at target if it exists
    if p.target != nil then
      local tx = p.target.x - p.x
      local ty = p.target.y - p.y
      local angle = atan2(tx, ty)
      p.lookx = cos(angle)
      p.looky = sin(angle)
    end

    -- auto-fire
    if p.atk_cooldown == 0 then
      p.atk_timer = 5
      p.atk_cooldown = 15
      p.atk_x = p.x + (p.lookx * 10)
      p.atk_y = p.y + (p.looky * 10)
    end
  else
    -- button released
    p.target = nil
    if dx != 0 or dy != 0 then
      p.lookx = dx
      p.looky = dy
    end
  end
end

-- helper: find nearest enemy within player's radius
function find_closest_in_range()
  local closest = nil
  local min_dist = 999
  
  for e in all(enemies) do
    local d = distance_to(e)
    if d <= p.r and d < min_dist then
      min_dist = d
      closest = e
    end
  end
  return closest
end

-- helper: simple distance math
function distance_to(obj)
  return sqrt((obj.x-p.x)^2 + (obj.y-p.y)^2)
end
-->8
function _draw()
  cls()
  
  -- 1. draw the range circle around the player
  -- color 5 is a dark grey, so it's not too distracting
  circ(p.x, p.y, p.r, 5)
  
  -- draw all enemies
  for e in all(enemies) do
    local col = 6
    -- highlight if this is our current target
    if (p.target == e) col = 12 
    circ(e.x, e.y, e.r, col)
    spr(e.sp, e.x-4, e.y-4)
  end
  
  -- draw player & indicator
  spr(p.sp, p.x-4, p.y-4)
  pset(p.x + p.lookx*6, p.y + p.looky*6, 8)
  
  -- draw attack
  if p.atk_timer > 0 then
    circfill(p.atk_x, p.atk_y, 2, 12)
  end
  
  
 
end
__gfx__
00000000000000000200002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008888000200002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700088888800020020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000088888800222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000088888800282282000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700088888800022220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008888000002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000006666666660000000000000000000000000066666666600000000000000000000000000000000000000
00000000000000000000000000000000000000000066660000000006666000000000000000000666600000000066660000000000000000000000000000000000
00000000000000000000000000000000000000006600000000000000000660000000000000066000000000000000006600000000000000000000000000000000
00000000000000000000000000000000000000660000000000000000000006600000000006600000000000000000000066000000000000000000000000000000
00000000000000000000000000000000000066000000000000000000000000066000000660000000000000000000000000660000000000000000000000000000
00000000000000000000000000000000000600000000000000000000000000000600006000000000000000000000000000006000000000000000000000000000
00000000000000000000000000000000006000000000000000000000000000000060060000000000000000000000000000000600000000000000000000000000
00000000000000000000000000000000060000000000000000000000000000000006600000000000000000000000000000000060000000000000000000000000
00000000000000000000000000000000600000000000000000000000000000000006600000000000000000000000000000000006000000000000000000000000
00000000000000000000000000000006000000000000000000000000000000000060060000000000000000000000000000000000600000000000000000000000
00000000000000000000000000000060000000000000000000000000000000000600006000000000000000000000000000000000060000000000000000000000
00000000000000000000000000000600000000000000000000000000000000006000000600000000000000000000000000000000006000000000000000000000
00000000000000000000000000000600000000000000000000000000000000006000000600000000000000000000000000000000006000000000000000000000
00000000000000000000000000006000000000000000000000000000000000060000000060000000000000000000000000000000000600000000000000000000
00000000000000000000000000006000000000000000000000000000000000060000000060000000000000000000000000000000000600000000000000000000
00000000000000000000000000060000000000000000000000000000000000600000000006000000000000000000000000000000000060000000000000000000
00000000000000000000000000060000000000000000000000000000000000600000000006000000000000000000000000000000000060000000000000000000
00000000000000000000000000600000000000000000000000000000000006000000000000600000000000000000000000000000000006000000000000000000
00000000000000000000000000600000000000000000000000000000000006000000000000600000000000000000000000000000000006000000000000000000
00000000000000000000000000600000000000000000000000000000000006000000000000600000000000000000000000000000000006000000000000000000
00000000000000000000000000600000000000000000000000000000000006000000000000600000000000000000000000000000000006000000000000000000
00000000000000000000000006000000000000000000000200002000000060000000000000060000002000020000000000000000000000600000000000000000
00000000000000000000000006000000000000000000000200002000000060000000000000060000002000020000000000000000000000600000000000000000
00000000000000000000000006000000000000000000000020020000000060000000000000060000000200200000000000000000000000600000000000000000
00000000000000000000000006000000000000000000000222222000000060000000000000060000002222220000000000000000000000600000000000000000
00000000000000000000000006000000000000000000000282282000000060000000000000060000002822820000000000000000000000600000000000000000
00000000000000000000000006000000000000000000000022220000000060000000000000060000000222200000000000000000000000600000000000000000
00000000000000000000000006000000000000000000000002200000000060000000000000060000000022000000000000000000000000600000000000000000
00000000000000000000000006000000000000000000000000000000000060000000000000060000000000000000000000000000000000600000000000000000
00000000000000000000000006000000000000000000000000000000000060000000000000060000000000000000000000000000000000600000000000000000
00000000000000000000000000600000000000000000000000000000000006000000000000600000000000000000000000000000000006000000000000000000
00000000000000000000000000600000000000000000000000000000000006000000000000600000000000000000000000000000000006000000000000000000
00000000000000000000000000600000000000000000000000000000000006000000000000600000000000000000000000000000000006000000000000000000
00000000000000000000000000600000000000000000000000000000000006000000000000600000000000000000000000000000000006000000000000000000
00000000000000000000000000060000000000000000000000000000000000600000000006000000000000000000000000000000000060000000000000000000
00000000000000000000000000060000000000000000000000000000000000600000000006000000000000000000000000000000000060000000000000000000
00000000000000000000000000006000000000000000000000000000000000060000000060000000000000000000000000000000000600000000000000000000
00000000000000000000000000006000000000000000000000000000000000060000000060000000000000000000000000000000000600000000000000000000
00000000000000000000000000000600000000000000000000000000000000006000000600000000000000000000000000000000006000000000000000000000
00000000000000000000000000000600000000000000000000000000000000006000000600000000000000000000000000000000006000000000000000000000
00000000000000000000000000000060000000000000000000000000000000000600006000000000000000000000000000000000060000000000000000000000
00000000000000000000000000000006000000000000000000000000000000000060060000000000000000000000000000000000600000000000000000000000
00000000000000000000000000000000600000000000000000000000000000000006600000000000000000000000000000000006000000000000000000000000
00000000000000000000000000000000060000000000000000000000000000000006600000000000000000000000000000000060000000000000000000000000
00000000000000000000000000000000006000000000000000000000000000000060060000000000000000000000000000000600000000000000000000000000
00000000000000000000000000000000000600000000000000000000000000000600006000000000000000000000000000006000000000000000000000000000
00000000000000000000000000000000000066000000000000000000000000066000000660000000000000000000000000660000000000000000000000000000
00000000000000000000000000000000000000660000000000000000000006600000000006600000000000000000000066000000000000000000000000000000
00000000000000000000000000000000000000006600000000000000000660000000000000066000000000000000006600000000000000000000000000000000
00000000000000000000000000000000000000000066660000000006666000000000000000000666600000000066660000000000000000000000000000000000
00000000000000000000000000000000000000000000006666666660000000000000000000000000066666666600000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000008888000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000088888800000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000088888800000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000088888800000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000088888800000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000008888000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

